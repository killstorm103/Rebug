package me.killstorm103.Rebug.Commands;

import java.util.ArrayList;
import org.bukkit.Bukkit;
import org.bukkit.ChatColor;
import org.bukkit.Material;
import org.bukkit.inventory.ItemStack;
import org.bukkit.command.CommandSender;
import org.bukkit.craftbukkit.v1_8_R3.entity.CraftPlayer;
import org.bukkit.entity.Player;
import org.bukkit.inventory.*;
import org.bukkit.inventory.meta.ItemMeta;

import me.killstorm103.Rebug.Main.Command;
import me.killstorm103.Rebug.Main.Rebug;
import me.killstorm103.Rebug.Utils.PT;
import net.minecraft.server.v1_8_R3.*;

public class Exploit extends Command
{

	@Override
	public String getName() {
		return "exploit";
	}

	@Override
	public String getSyntax() {
		return "exploit <Exploit or 'menu'> <Player>";
	}

	@Override
	public String getDescription() {
		return "Exploits";
	}

	@Override
	public String getPermission() {
		return StartOfPermission() + "exploitcmd";
	}
	private ArrayList<String> lore = new ArrayList<>();
	@Override
	public void onCommand(CommandSender sender, String[] args) throws Exception
	{
		if (args.length < 2)
		{
			Log(sender, getSyntax());
			return;
		}
		String exploit = args[1];
		if (exploit.equalsIgnoreCase("menu") && sender instanceof Player)
		{
			if (sender instanceof Player)
			{
				Player player = (Player) sender;
				lore.clear();
				
				// Size can be: 9, 18, 27, 36, 45, 54
				Inventory inventory = Bukkit.createInventory(player, 9, ChatColor.DARK_RED + "Exploits");
				
				inventory.clear();
				ItemStack item = new ItemStack(Material.DEAD_BUSH);
				ItemMeta meta = item.getItemMeta();
				meta.setDisplayName(ChatColor.RED + "Fake Death");
				lore.add("Fake Death Exploit!");
				lore.add("Makes the client");
				lore.add("think the player");
				lore.add("died but didn't");
				lore.add("and is now bugged");
				lore.add("out and can't respawn");
				meta.setLore(lore);
				item.setItemMeta(meta);
				inventory.setItem(0, item);
				
				
				item = new ItemStack(Material.ANVIL);
				meta = item.getItemMeta();
				meta.setDisplayName(ChatColor.RED + "Demo");
				lore.clear();
				lore.add("Demo Exploit!");
				lore.add("Makes the players game");
				lore.add("think it's a demo!");
				meta.setLore(lore);
				item.setItemMeta(meta);
				
				inventory.setItem(1, item);
				
				player.openInventory(inventory);
			}
			else
				Rebug.getGetMain().getServer().getConsoleSender().sendMessage("Only players can use this command!");
				
			return;
		}
		if (args.length < 3)
		{
			Log(sender, getSyntax());
			return;
		}
		Player player = getRebug().getServer().getPlayer(args[2]);
		if (player == null)
		{
			Log(sender, "Unknown Player!");
			return;
		}
		EntityPlayer px = ((CraftPlayer) player).getHandle();
		Packet<?> packet = null;
		
		if (exploit.equalsIgnoreCase("demo")) // makes the minecraft client think it's a demo!
		{
			packet = new PacketPlayOutGameStateChange(5, 0);
			PT.SendPacket(player, packet);
			Log(sender, "tried using the Demo exploit on " + player.getName());
		}
		if (exploit.equalsIgnoreCase("fakedeath")) // glitches the player out to where the client thinks their dead but their not also their not able to Respawn or do anything until rejoining!
		{
			packet = new PacketPlayOutEntityStatus(px, (byte) 3);
			PT.SendPacket(player, packet);
			Log(sender, "tried using the Fake Death exploit on " + player.getName());
		}
		if (exploit.equalsIgnoreCase("Test"))
		{
			packet = new PacketPlayOutOpenWindow (-Integer.MAX_VALUE, "minecraft:container", px.inventory.player.getScoreboardDisplayName());
			Log(sender, "tried using the test exploit on " + player.getName());
		}
	}
	
}
